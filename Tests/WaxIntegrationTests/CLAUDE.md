# Tests/WaxIntegrationTests

## Purpose
Integration tests that exercise the full Wax stack: unified search, FastRAG context builder, PhotoRAG, VideoRAG, PDF ingestion, MiniLM embeddings, vector search engines, and timestamp overrides.

## Test Categories

- **UnifiedSearchTests**: Hybrid search, text-only, vector-only, timeline fallback, structured memory, frame filtering.
- **VectorSearchEngineTests**: CPU and Metal vector search, cosine similarity, dimension validation.
- **FastRAGContextBuilder tests**: Expansion, surrogates, snippets, token budgets, tier selection.
- **PhotoRAGOrchestratorTests**: Ingest, recall, delete, deduplication, location queries, constraint-only queries.
- **PhotoRAGConstraintQueriesTests**: Time-range and location-radius filtering without text queries.
- **PhotoRAGIngestDedupeTests**: Re-ingest deduplication and supersede behavior.
- **VideoRAGFileIngestIntegrationTests**: File-based video ingest, segment generation, recall, transcript mapping.
- **PDFIngestTests**: PDF text extraction, metadata keys, error cases (blank PDF, missing file).
- **TimestampOverrideTests**: Capture-time semantics for photo/video frames.
- **MiniLMEmbedderTests**: CoreML model loading, single/batch encoding, embedding quality.
- **MiniLMEmbeddingQualityTests**: Semantic similarity benchmarks, cosine distance thresholds.

## Fixtures

- `Fixtures/pdf_fixture_text.pdf` -- Multi-page PDF with extractable text.
- `Fixtures/pdf_fixture_blank.pdf` -- PDF with no extractable text (tests error path).

## Opt-in Benchmarks

Some tests are opt-in via environment variables:
- `WAX_TEST_MINILM=1` -- Enable MiniLM CoreML inference tests.
- `WAX_BENCHMARK_MINILM=1` -- MiniLM performance benchmarks.
- `WAX_BENCHMARK_METAL=1` -- Metal GPU vector search benchmarks.
- `WAX_BENCHMARK_10K=1` -- Large-scale (10K document) benchmarks.

## Conventions

- Integration tests create temporary `.mv2s` stores and clean up after.
- Photo/Video RAG tests use mock embedders and providers (not real Photos/AVFoundation).
- Tests validate determinism: same input produces same output across runs.

## Running

```bash
swift test --filter WaxIntegrationTests
WAX_TEST_MINILM=1 swift test --filter MiniLMEmbedderTests
```


<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

*No recent activity*
</claude-mem-context>